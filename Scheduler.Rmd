---
title: "Scheduler"
author: "David Moste"
date: "7/25/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Obtain Data

```{r}
df <- read.csv("https://raw.githubusercontent.com/dmoste/Scheduler/main/Masked%20Transcripts%202018-19.csv")
```

Select data only from before the desired term.
Remove the GPA Modifier symbol (*) and create a binary designation.
Add in college course designation.

```{r}
df <- df %>%
  filter(SchoolYear < 2018) %>%
  separate(Table, c("Code","GPA.Modify"), sep = "\\*") %>%
  mutate(College = ifelse(grepl("U$", Code) | Code == "HBS11UA", "Y", "N")) %>%
  as_tibble()

df$GPA.Modify[is.na(df$GPA.Modify)] <- 0
df$GPA.Modify[df$GPA.Modify == ""] <- 1
```

StudentID is only listed for the last instance of each student. This section of code pulls up that ID number through all the rows of a student. I then converted all the course codes into usable names as columns so that the ranger package can use them as features later.

```{r}
#df$StudentID <- nafill(df$StudentID, type = "nocb")
df$Code <- make.names(df$Code, unique = FALSE, allow_ = FALSE)
```

This makes each course code a valid feature name and takes the max score a student received in a course as the official score.

```{r}
df <- df %>%
  pivot_wider(names_from  = Code,
              values_from = NumericEquivalent) %>%
  group_by(StudentID) %>%
  left_join(attendance, by = "StudentID") %>%
  summarise_if(is.numeric,
               max,
               na.rm = TRUE)
```


In this step, I converted all the -Inf generated by the summarise_if statement into NAs so that they could then be imputed by missRanger.

```{r}
df[df == -Inf] <- NA
df <- df[, which(colMeans(!is.na(df)) > 0.05)]
df <- df %>%
  mutate(Imputed = ifelse(is.na(df[course]), 1, 0)) %>%
  select(-TermCD, -SchoolYear)
```









